```
호스트는 왜 호스트라고 부른다고 했어요?
네트웍 애플리케이션을 호스팅하고 있다고 해서
네트웍 애플리케이션 실행되고 있음
그냥 애플리케이션이랑 다른점이 뭐에요?
다른 컴퓨터에 있는 상대에게 메시지를 보내죠 혹은 받기도 하고
그래서 이 호스트에서는 사용자의 애플리케이션 메시지가 발생하게 되어요
그러면 이 호스트에서는 이거를 액세스 네트웍으로 내보내는 역할을 하는데 내보내기 전에
이 애플리케이션 메시지를 패킷이라고 불리는 청크로 짤라줘요
짜르는 이유에 대해서는 좀 있다 다시 살펴봄
링크로 내보내게 됨
패킷의 크기가 L비트고 트랜스미션 레이트가 R이면 호스트에서 내보내는 시간은?
L(bits)
---
R(bits/sec)

호스트에서의 주된 역할은 패킷으로 짤라서 액세스 네트웍으로 내보내는거다

(physical media 설명)
coax랑 fiber가 좋아요

링크와 스위치의 네트워크를 통해 데이터를 이동시키는 방식에는 회선 교환(circuit switching)과 패킷 교환(packet switching)이라는 두가지 기본 방식이 있다.
회선 교환 네트워크에서는 FDM과 TDM이 있다.

이게 링크에 가용한 프리퀀시라고 할 때, 이 프리퀀시를 가져다가 몇개 대역으로 나눠요
그래서 사용자별로 어때요? 이러케 다른 대역을 다른 프리퀀시를 할당해주는거죠
각 사용자는 별도의 프리퀀시를 할당받아서 계속 그 프리퀀시는 자기가 잡고 사용할 수 있게 하는거죠

반면에 TDM은 링크에 가용하 ㄴ프리퀀시 전체를 사용자들이 사용할 수 있게 하되, 시간을 짤라서 시간을 할당하는거죠
그래서 돌아가면서 사용자들이 링크 프리퀀시를 사용할 수 있게
자 그런데 이 서킷 스위칭은 전화 네트워크에서는 매우 적합했지만 데이타 네트웍
인터넷 같은 곳에서는 불합리하게 되었어요 왜그럴까요?
전화나 인터넷에서 발생하는 통신의 차이점을 보자면
전화는 일단 콜을 하고 나면 어때요? 가만히 아무 얘기도 안하고 있는때가 있어요 없어요? 없죠?
전화를 콜한다음에는 행업될때까지는 컨티뉴어스하게 전달이되죠
컴퓨터간에 통신은 어때요? 인털미턴드하고 벌스해요 (?) 어떤 리퀘스트가 있으면 데이터가 왕창 발생하지만, 한동안 아무것도 발생하지 않을때가 있다
그런데 설킷 스위치처럼 두개의 커뮤니케이링 포인트 사이에 자원을 예약해놓으면 어케되요?
이 자원은 아무도 다른 사용자는 쉐어할 수 없어요 이 두 사용자를 위한 커넥션의 할당되어진 포션은 여기에 개런티된 예약된 자원이므로
데이타가 흐르고 있지 않더라도 그래서 계속 낭비되고 있는거에요 그쵸?
그래서 서킷 스위칭이 인터넷과 같은 데이타 네트웍에는 매우 비효율적이다
그래서 1960년대에 패킷 스위칭이라는 새로운 기법이 나온거에요

자 여러분 전화네트웍과 인터넷중 어떤게 먼저 나왔어요? 전화네트웍 그쵸?
서킷 스위칭과 패킷중에선? 서킷 그다음에 패킷

패킷 스위칭의 주요점 세가지
예약같은게 없어요 (no call set up)
no resource reservation
여기서는 필요가 발생하면 그때그때 리소스를 사용하게 해줘요
여기서 어떤 데이타를 가져다가 전달할 데이타가 생겼어요
그런데 이 링크를 지금 아무도 안사용하고 있어요 링크가 프리해요
그럼 어때요? 그럼 이 대역폭 전체를 사용해서 이 데이타를 이쪽으로 보내줘요
그런데 누가 사용하고 있으면 어케요? 그 사용이 끝날때까지 기다려요
(전달 끝날때까지)
그랬다가 다음 데이타를 전달해요
근데 일단 그 어떤 한 데이타가 이 링크를 차지하면 그럼 어때요? 링크 대역폭 전체를 사용해서 데이타 트랜스미션이 일어나게 되어요

그럼 가령 들어서 이 링크의 경우 여기서도 데이타가 들어오고 여기서도 데이타가 들어와요

둘다 여기로 가야한다면 둘중에 먼저 들어온 데이타가 이 링크를 사용해서 다음 홉으로 전달이 되는거에요 그 다음꺼는 트랜스미션 종료될때까지 기다리구요

여기서의 포인트가 뭐냐면? 각 데이타의 트랜스미션이 full link capacity를 이용해서 전달된다는거에요

자원을 분할해놓고 여러 데이타를 동시에 나눠서 내보낸다던지 이런게 없어요
그냥 한 데이타가 비슷한 링크를 차지하면 링크의 풀 link capacity를 이용해서 전달

quiz를 내볼까요
일단 긴 메시지가 트랜스미션 되기 시작하면? 굉장히 길다면? 잡고 있는 시간이 어케될까요? 길어지게 되요 굉장히 오래 잡고 있게 되요
유저 애플리케이션의 크기는 우리가? 그 바운더리를 정해놓은게 없어서 매우 길 수 있어요

그럼 이 네트웍내에서 리소스 쉐어링이 
one pair of user 커넥션만 지원하는거 아니잖아요

오랜시간동안 도미네이트 되어있다면 효율적으로 사용하는게 가능할까요? 아니죠

그동안 이 링크를 지나가야되는 다른 사용자가 못쓰겠죠 (전달될수 없어요)

그래서 패킷스위치는 기본적으로 애플리케이션에서 만들어내는 메시지를 갖다가 패킷이라는 청크로 짤라줘요

기본적인 역할이 뭐라고 했어요? 패킷으로 짤라서 액세스 네트워크로 밀어넣는거라고 했죠

그래서 짤르면 이제 각 패킷이 링크를 점유하는 시간은 어때요? 고정적이죠 거의
패킷의 크기를 일정하게 한다면 ㅇㅇ

아까 서킷 스위칭의 경우에는 일단 세팅하고 밀어넣으면 바로 그게 쭉 파이프를 타고 어디로 가요?
원래 목적한 곳으로 가게되있죠

그런데 여기서는 패킷을 이 링크로 내보낸다고 할때 그 서킷이 셋업이 안되어 있어요
그래서 어디로 가야될지 몰라요 이 라우트(터?)는

패킷을 잘라야하고 각 패킷에는 뭐가 필요해요? 목적지 주소가 명시되어 있어야 해요

패킷의 목적지 주소를 보고 아 다음에 뭐를 뽑아줘야겠다 정함

결국 각 라우터는 패킷이 다 도달할때까지 받는 작업만 하고 있는다 (동시에 뽑아낼수는 없다)

다 받고나면 주소를 파싱해서 목적지를 알아내고 어느링크로 뽑아내야할지 알고 포워딩을 한다

store-and-forward 하면 무슨 일이 일어나나 봅시다

소스에서 L비트짜리 패킷을 만들어서 링크에 집어넣었어요

이 링크의 밴드리스는 Rbps에요

다음라우터까지 가는데 시간이 얼마나 걸릴까요? L나누기 R세컨드만큼 걸려요
이게 지나면 그 패킷이 완전히 도착하게 되어요
그 라우터는 그 패킷을 어떻게 해야해요? 스토어를 해야해요

왜냐면 다음 패킷이 요기(데스티네이션)로 나가야 하는데 그쵸? 
이 링크가 지금도 아무도 이 링크를 사용하고 있지 않으면 패킷 전체를 스토어하자마자 목적지 주소를 보고 뽑아낼 링크 결정해서 내보낼 수 있어요

만약에 이 링크가 사용중이라면? 내가 일단 잠시 스토어하고 있어야해요 그랬다가 보내야해요
운이 좋아서 바로 내보낸다고 하더라도 시간이 L/R세컨드만큼 걸려요

그래서 우리가 얘로 가령 패킷의 사이즈가 7.5메가비트고 링크의 커패시티가 1.5메가비트인 경우
7.5 나누기 1.5해서 5초가 걸리게 되어요

하나 건너가는데 5초, 다시 건너가는데 5초. 최소 10초가 걸리게 되어요
(강의 노트 이미지 기준)

이게 아주 패킷 스위칭의 큰 특징이에요

일단 링크를 차지한 데이타가 그 데이타 전송이 완료될때까지 그 전체 커패시티를 그 데이타가 사용하기 땜에 패킷이라는 단위로 짤라요 (한 사용자가 너무 길게 사용하지 않기 위해)

각 패킷마다 목적지 정보를 싣고 있어야 해요
그리고 얘가 패킷 전체를 받아야지만 그 패킷에서 목적지 정보를 파싱해낼 수 있기 때문에 일단 각 홉에서 스토어 전체 받은 다음에 forward 할 수 있어요

그래서 store-and-forward 방식으로 hop by hop으로 목적지까지 전달이 되어요.

이 패킷스위칭은 뭐가 발생 할 수 있냐면 큐잉 딜레이가 발생할 수 있어요.
(queueing delay, 책 33페이지)
이게 왜 발생하냐? 이 라우터의 입장에서 보자면

이런식으로 지금 패킷이 흘러들어오고 있어요
이 라우터에서 패킷이 흘러들어오는 속도가 더 빠르다면
스토어하는곳에 패킷이 쌓이게 될거에요
큐 버퍼안에서 큐잉 딜레이가 발생!

이게 왜그래요? 자원이 전혀 예측할 수 없어요 이 네트웍에서 조만간 얼마나 필요하게 될지

들어오는대로 서비스해주기 때문에 어떤 짧은 시간 동안에는 패킷이 마구 쌓일 수 있고
큐잉 시간이 길어질 수 있다

패킷이 자꾸 쌓이다보면 버퍼가 꽉 찰 수 있는데
여기서 또 들어오면 어케되요? 그때 패킷 로스가 발생하게 되어요.
(packet loss)

패킷 스위칭은 네트웍 자원을 효율적으로 쉐어를 할 수는 있지만 큐잉 딜레이나 로스가 발생할 수 있다.
이런걸 심해지게 하면 뭐라고 하냐? congestion이라고 해요
(https://ko.wikipedia.org/wiki/%ED%98%BC%EC%9E%A1_%EC%A0%9C%EC%96%B4)

쉐어링 측면에서 리소스를 비교해보도록 합시다

1mb/s link가 있고 사용자는 100kb/s를 필요로 해요 액티브인동안은
그런데 모든 사용자가 계속 액티브인게 아니고 그랬다가 아닐때가 있는데 전체 시간중에서는 액티브가 10%에 불과해요

액티브 했다하면 어때요? 100kb/s를 요구해요

열명의 사용자가 동시에 액티브하면 얼마나 필요한거죠? 1mb 그쵸
100kb X 10하면 1000kb가 되어서 1메가가 되는거에요

그래서 열명의 사용자가 동시에 사용하면 1메가가 필요한건데 그렇지만 어때요? 이 사용자들이 동시에 액티브할일이 별로 없어요 (열명이 동시에 ㅇㅇ) 것도 그런게 10%니까

서킷은 몇명까지 수용가능해요? 열명.
이 링크 대역폭을 가장 잘 분할하면 100kb로 쫙분할하면 열명이죠
사용자가 콜을할때마다 백씩 나눠주다가 열명 나눠주고나면 끝이에요! 열명 이상 사용할수가 없어요

그런데 패킷 스위칭의 경우에는 우리가 직접 계산하는 과정을 거치지 않겠지만
35명이 가용
그리고 35명중에서 10명이 동시에 액티브할 확률은 0.0004밖에 안된다는거에요
그러니 큰 무리가 없다는거에요 서른 다섯명이 동시에 사용하더라도
리소스 사용이 훨씬 효율적으로 일어난다

하지만 이 패킷 스위칭의 문제는 뭐에요? 리소스를 예약해놓지 않기 때문에 congestion이 발생한다는거

bursty한 data에 대해 리소스 쉐어링도 좋고 콜 셋업이 없으니 간단하다
딱 데이타 그냥 발생하자마자 착 네트워크에 목적지 주소만 꽝 찍어서 집어넣을 수 있다
문제는 congestion..
특히 오디오나 비디오같은 애플리케이션에서 얘네가 발생시키는 데이타를 스트리밍이라고 해요 혹은 이런 애플레>ㅣ케이션을 스트리밍 애플리케이션이라고 부른다

여기서는 딜레잉이 중요한데 아무리 목적지에 잘 도착한다고 하더라도 이전 프레임과의 간격이 너무 딜레이되어서 도착하거나 자기 앞 프레임보다 더 빨리 도착한다거나 하면 유효하지 않고 너무 빨리 가도 안된다는거죠

네트웍에서 딜레이가 일정 미만이어야 하는데 그런데 패킷 스위칭에서는 guarantee 할 수 있어요 없어요? 할수가 없어요
왜냐면 굉장히 다이내믹한 네트웍 상황에 따라서 큐잉 딜레이가 달라지게 되요
소스에서 데스티네이션 가는동안 중간에 어떤 스팟에서 큐잉 딜레이가 굉장히 커진다면
그 데이타가 전송되는데 딜레이가 아주 길어질거에요 그래서 이게 문제에요

이런 애플리케이션들 때문에 이 패킷스위칭에서 컨제스쳔은 굉장히 큰 문제가 될 수 있다

어떻게 하면 이 서킷같은 양상을 패킷에서 보일 수 있을까 연구를 마니했다
책에 연구된 솔루션들이 소개가 되어있다.

정리를 해보면.
네트웍 코어의 의무는 소스에서 데스티네이션까지 데이타를 전달해주는거
그 방법은 크게 패킷 스위칭과 서킷 스위칭 두가지로 나눌 수 있다

그럼 이 코어를 좀 더 상세하게 살펴보겠어요

라우터랑 스위치들이 매우 복잡하게 연결되어있다고만 얘기해왔는데
자세히 들여다보면 그냥 플랫하게 연결된게 아니고 네트웍들의 네트웍으로 연결되어있어요

즉 구조를 가지고 있다는거에요 스트럭쳐를 가지고 있다는건데 어떻게 형성이되냐면 경제적인 이유 국가간의 정책 이런 요인들로 인해서 점진적으로 리볼브해왔어요 그래서 굉장히 복잡한 구조를 가지고 있어요

특정 케이스를 가지고 얘기할 수는 없겠지만 어떤 방식으로 되어왔다는 것과 제너럴한 스트럭쳐를 갖다가 살펴보도록 하겠어요

우리가 지금까지 알고 있는거는 인터넷 코어 가장자리에는 액세스 네트웍들이 쫙있다
이게 뭘 연결해주고 있다? 호스트를 연결해주고 있다
데이터가 전달되기 위해서 액세스 네트웍만 있으면 안된다

서로 연결되어 있어야 한다
그런데 모두가 각각 연결되어있으면? O(N제곱)개의 커넥션이 필요하다
이럴수는 없다

보통 어떻게 연결되냐면 ISP가 있어요
인터넷 서비스를 제공하는 사업자. 이 사업자가 자기의 네트웍을 가지고 있어요. 라우터들의 연결을 갖고 있어요

이 ISP의 라우터들은 서로 다 연결되어있어요
이산수학에서 배운 커넥티드를 이뤄요

어느 한 임의의 라우터로부터 다른 라우터까지의 경로가 반드시 있어요

이런 사업자가 연결된 라우터들의 그룹을 갖고 있다면 호스트간의 연결은 어때요?
어느 한 ISP의 라우터에 연결되어있기만 하면 되어요
연결되어있다면 어때요? 얘도 연결되어있고

이렇게 전달이 된다음 갈수가 있어요 그래서 결국 글로벌 ISP의 모든 액세스 네트웍들이 다 연결되면 되어요

그렇게 하면 어떤 액세스 네트웍에 물려있는 호스트라 할지라도 다 갈수 있다 데이터를 전달할 수 있다

이 글로벌 ISP는 사업자에요 그쵸? 그럼 어케하겠어요 인터넷 제공해주는 돈을 받겠죠

업체가 여러분 집에다가 접속료 돈을 받죠 이걸 다시 글로벌 ISP에다가 돈을 주죠

그리고 글로벌 ISP 사업자도 여럿이에요
문제는 이렇게 여럿이 생겨나서 서로간의 피어링 링크를 가지게 되어요
(peering link)
ISP간에 서로 연결..
-> 안되어있으면 ISP A의 호스트랑 ISP B의 호스트랑 연결을 할수가 없당

그런데 이 ISP끼리 연결해주는게 비지니스에요 이제 또 나온게 IXP에요
Internet Exchange point
이건 ISP끼리 연결해주는 역할을 하는 사업자에요

건물 하나를 사서 스위치만 쫙~~ 층층이 다 설치를 해놨어요
그러고서 ISP끼리 연결시켜주는거에요

근데 매우 방대한 ISP라고 할지라도 지구가 너무 넓어서 모든 도시로 접근할수는 없어요
그래서 뭐냐면 regional net(ISP) 생겨나게 되어요

어떤 작은 지역의 네트워크를 담당해서 호스트가 리저널 ISP로 연결되도록 그리고 작은 지역의 리저널이 좀 더 큰 지역의 리저널로
좀 더 큰 지역의 리저널은 ISP로

multi-tire hierarchy!

first-tire ISP가 세계에서 연결되는거에요

그래서 컨슈머 ISP들에게 인터넷에 접속하도록 해주기 위해서는 프로바이더 ISP에서 연결될 수 있는 접속점을 줘야해요
이걸 point-of-presence라고 해요

regional ISP도 가끔 같은 등급의 regional ISP랑 피어링 링크를 맺기도 한다
settlement-free를 위해서.

R ISP A랑 R ISP B 둘이 매달려 있는데 트래픽이 많이 발생하면 이러케 연결 맺을 수도 있는데
하게 되면 좋은 점이 ISP에 지불하는 비용을 줄일 수 있다

그리고 경우에 따라서는 multi-home을 하게 되어요

작은 ISP는 자기 위의 ISP랑 최소 한개는 연결이 되어야 해요
그런데 얘가 한개가 아니라 두개이상 hierarchy ISP를 둘 수 있다
이러케 되면 혹시 하나가 페일이 나도 나머지랑 연결될 수 있다

요즘은 여기에 또 추가가 되었어요
컨텐츠 프로바이더 네트워크

구글이나 MS는 컨텐츠를 서비스하고 굉장히 많은 양을 가지고 있죠

이 데이터 센터가 전 세계에 있는데 유저들에게 보급하려면 이 컨텐츠 프로바이더들이 발생시키는 데이터량이 많다.
어디다가 돈을 많이 지불할까요? 인터넷 서비스 프로바이더들한테 막대한 돈을 지불한다.
그래서 자기들끼리 온 네트웍을 만들었다.
자기네 회사들의 네트웍을 다 연결하는 컨텐츠 프로바이더 네트웍을 만든다.
일부 지역 사용자들은 여기에 직접 연결한다.

구글 예를 들어보면 30~50개의 데이터센터가 있고 여기에는 수천개의 서버가 들어차있다.
구글은 프라이빗 네트워크를 통해서 자기 데이터센터를 연결함으로서 upper-tire ISPs에 주는 돈을 절약하고
자기 서비스의 컨트롤을 좋게 했다


```

